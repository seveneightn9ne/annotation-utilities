<html>

<head>
    <title>TLE</title>	
    <link rel="stylesheet" href="http://spyysalo.github.io/conllu.js/css/jquery-ui-redmond.css">
    <link rel="stylesheet" href="http://spyysalo.github.io/conllu.js/css/main.css">
    <link rel="stylesheet" href="http://spyysalo.github.io/conllu.js/css/style-vis.css">
    <link rel="stylesheet" type="text/css" href="searchstyle.css">
    <script src="jquery-1.12.3.min.js"></script>
    <script type="text/javascript" src="http://spyysalo.github.io/conllu.js/lib/ext/head.load.min.js"></script>
    <script src="jsfunctions.js"></script>
    <script type="text/javascript">
		function do_search(event) {
			$('#results').empty();
			var query = document.getElementById("search_field").value;
    		var error = document.getElementById("error").value;
    		var corpus = document.getElementById("corpus_list").value;
    		var show_corr = document.getElementById("corr").checked;
    		var hl_err = document.getElementById("hl_err").checked;
    		$('#results').append("<p>Searching for <b>"+query+"</b>...</p>");	
    		var ajax_url = "/search?query="+encodeURIComponent(query)+"&corpus="+corpus+"&error="+error;
			$.get(ajax_url, success=function(response){
				$('#results').empty();
				$('#results').append(format_response(response, show_corr, hl_err));
				Annodoc.activate(Config.bratCollData, documentCollections);
			});
		}
		function checkSubmit(e) {
   			if(e && e.keyCode == 13) {
      			document.getElementById("search_button").click();
   			}
		}
		function format_response(response, show_corr, hl_err) {
			console.log(response.matches.length);
			var html_string = "";
			html_string += '<div id="search-results-header">';
			html_string += "<p>You searched for <i>"+response.query.query+"</i> in the "+response.query.corpus+" corpus.</p>";
			html_string += "<p>"+response.matches.length+" matching sentences.</p>";
			html_string += "</div>";

			for(var i=0; i<response.matches.length; i++) {
				html_string += '<div class="result">';
				var match_positions = [].concat.apply([], response.matches[i].positions);
				for(var j=0; j<response.matches[i].sentence.words.length; j++) {
					if(match_positions.indexOf(j) >= 0) {
						html_string += '<span class="match">' + response.matches[i].sentence.words[j].word + '</span> ';
					} else {
						html_string += response.matches[i].sentence.words[j].word + ' ';
					}
				}
				if(hl_err) {
					html_string += '<br/>' + response.matches[i].sentence.sent_xml;
				}
				html_string += wrap_sentence_fulltext(response.matches[i].sentence.fulltext);
				html_string += '<br/>';
				if(show_corr) {
					html_string += wrap_sentence_fulltext(response.matches[i].sentence.corrected.fulltext);
				}
				html_string += '</div>';
			}
			return html_string;
		}

		function wrap_sentence_fulltext(text) {
			return '<pre><code class="language-conllu">'+text+'\n\n</code></pre>';
		}
    </script>
</head>

<body>

	<div id="search-box" onKeyDown="return checkSubmit(event)">
		<label for="search">Search:</label>
		<input type="text" id="search_field">
		<label for="corpus">Corpus:</label>
		<select id="corpus_list">
			<option value="esl">ESL</option>
			<option value="eng">English</option>
		</select><br>	  		
		<label for="error">Error type:</label>
		<select id="error">
			<option value=""> </option>
			<option value="AGN">Agreement noun</option>
			<option value="AGV">Agreement verb</option>
			<option value="AGA">Agreement pronoun</option>
			<option value="AGD">Agreement determiner</option>
			<option value="AGQ">Agreement quantifier</option>
			<option value="AS">Argument structure</option>
			<option value="CL">Collocation</option>
			<option value="CE">Compound</option>
			<option value="CD">Countability determiner</option>
			<option value="CN">Countability noun</option>  
			<option value="CQ">Countability quantifier</option>
			<option value="DJ">Derivation adjective</option>
			<option value="DY">Derivation adverb</option>
			<option value="DD">Derivation determiner</option>
			<option value="DN">Derivation noun</option>
			<option value="DT">Derivation preposition</option>
			<option value="DA">Derivation pronoun</option>
			<option value="DQ">Derivation quantifier</option>
			<option value="DV">Derivation verb</option>
			<option value="FJ">Form adjective</option>
			<option value="FY">Form adverb</option>
			<option value="FD">Form determiner</option>
			<option value="FN">Form noun</option>
			<option value="FA">Form pronoun</option>
			<option value="FQ">Form quantifier</option>
			<option value="FV">Form verb</option>
			<option value="IJ">Formation adjective</option>
			<option value="IY">Formation adverb</option>
			<option value="ID">Formation determiner</option>
			<option value="X">Formation negation</option>
			<option value="IN">Formation noun</option>
			<option value="IA">Formation pronoun</option>
			<option value="IQ">Formation quantifier</option>
			<option value="IV">Formation verb</option>  
			<option value="MJ">Missing adjective</option>
			<option value="MY">Missing adverb</option>
			<option value="MC">Missing conjunction</option>
			<option value="MD">Missing determiner</option>
			<option value="MN">Missing noun</option>
			<option value="MT">Missing preposition</option>
			<option value="MA">Missing pronoun</option>
			<option value="MP">Missing punctuation</option>
			<option value="MQ">Missing quantifier</option>
			<option value="MV">Missing verb</option>
			<option value="L">Register</option>
			<option value="RJ">Replace adjective</option>
			<option value="RY">Replace adverb</option>
			<option value="RC">Replace conjunction</option>
			<option value="RD">Replace determiner</option>
			<option value="RN">Replace noun</option>
			<option value="RT">Replace preposition</option>
			<option value="RQ">Replace quantifier</option>
			<option value="RA">Replace pronoun</option>
			<option value="RP">Replace punctuation</option>
			<option value="RV">Replace verb</option>
			<option value="S">Spelling</option>
			<option value="SA">Spelling (American)</option>
			<option value="SX">Spelling confusion</option>
			<option value="TV">Tense verb</option>
			<option value="UJ">Unnecessary adjective</option>
			<option value="UY">Unnecessary adverb</option>
			<option value="UC">Unnecessary conjunction</option>
			<option value="UD">Unnecessary determiner</option>
			<option value="UN">Unnecessary noun</option>
			<option value="UT">Unnecessary preposition</option>
			<option value="UA">Unnecessary pronoun</option>
			<option value="UP">Unneccessary punctuation</option>
			<option value="UQ">Unnecessary quantifier</option>
			<option value="UV">Unnecessary verb</option>			  
			<option value="W">Word order</option>
		</select><br>
		<input type="checkbox" id="corr" value="true"> Show corrected version<br>
		<input type="checkbox" id="hl_err" value="true"> Highlight errors<br>
		<button id="search_button" onclick="do_search()">Search</button>
	</div>

	<a href="#" style="color:#03a9f4"; onclick="return toggleMe('instructions')">Instructions</a>
	<div id="instructions" style="display:none">
		<p>You may search for a combination of verbatim words, regexes that match words, and part of speech categories.</p>
		<p>For example:
			<ul>
				<li>go there <i>matches</i> the string "go there"</li>
				<li>go <b>\w+</b>ing <i>matches</i> "go swimming", "go shopping", etc.
				<li>go <b>VERB</b> <i>matches</i> "go swimming", etc., but also "go travel", "go look", etc.</li>
			</ul>

		<p>Available part of speech categories:</p>
		<p><b>ADJ, ADV, INTJ, NOUN, PROPN, VERB, ADP, AUX, CONJ, DET, NUM, PART, PRON, SCONJ,<br>PUNCT, SYM, X</b></p>
	</div>
	<div id="results">
	</div>

	
</body>

<!-- XXX -->

</article>

</body>

<script type="text/javascript">
	var root = 'http://spyysalo.github.io/conllu.js/'; // filled in by jekyll
	head.js(
		// External libraries
		root + 'lib/ext/jquery.min.js',
		root + 'lib/ext/jquery.svg.min.js',
		root + 'lib/ext/jquery.svgdom.min.js',
		root + 'lib/ext/jquery-ui.min.js',
		root + 'lib/ext/waypoints.min.js',

		// brat helper modules
		root + 'lib/brat/configuration.js',
		/* root + 'lib/brat/util.js', */
		'util.js',
		root + 'lib/brat/annotation_log.js',
		root + 'lib/ext/webfont.js',
		// brat modules
		root + 'lib/brat/dispatcher.js',
		root + 'lib/brat/url_monitor.js',
		root + 'lib/brat/visualizer.js',

		// annotation documentation support
		'http://spyysalo.github.io/annodoc/lib/local/annodoc.js',
		root + 'lib/local/config.js',

		// the conllu.js library itself
		root + 'conllu.js'
	);

	var webFontURLs = [
		root + 'static/fonts/PT_Sans-Caption-Web-Regular.ttf',
		root + 'static/fonts/Liberation_Sans-Regular.ttf'
	];

	/* not used here */
	var documentCollections = {};

	head.ready(function() {
	// performes all embedding and support functions
	Annodoc.activate(Config.bratCollData, documentCollections);
	});
</script>



</html>